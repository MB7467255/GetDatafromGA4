<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Analytics Demographics</title>
    <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>
    <h1>Google Analytics Demographics Data</h1>
    <button id="authButton">Authorize</button>
    <button id="fetchDataButton" style="display:none;">Fetch Demographics</button>
    <div id="output"></div>

    <script>
        const CLIENT_ID = '275358461010-gd0ikq8ksa17vsf5flrbftcan6bmga3d.apps.googleusercontent.com'; // Replace with your OAuth 2.0 Client ID
        const API_KEY = 'AIzaSyBKimLL3cJbFvEXii52CJPweMzm92_GkSE'; // Replace with your API Key
        const PROPERTY_ID = '342070113'; // Replace with your GA4 Property ID

        // Load Google API Client
        gapi.load("client:auth2", () => {
            gapi.auth2.init({
                client_id: CLIENT_ID,
                scope: "https://www.googleapis.com/auth/analytics.readonly"
            });
        });

        document.getElementById("authButton").addEventListener("click", () => {
            gapi.auth2.getAuthInstance().signIn().then(() => {
                document.getElementById("fetchDataButton").style.display = "block";
                console.log("User signed in");
            });
        });

        document.getElementById("fetchDataButton").addEventListener("click", () => {
            fetchDemographicsData();
        });

        function fetchDemographicsData() {
            gapi.client.setApiKey(API_KEY);
            gapi.client.load("https://analyticsdata.googleapis.com/$discovery/rest?version=v1").then(() => {
                gapi.client.analyticsdata.properties.runReport({
                    property: `properties/${PROPERTY_ID}`,
                    requestBody: {
                        dimensions: [
                            { name: "country" },
                            { name: "gender" },
                            { name: "age" }
                        ],
                        metrics: [
                            { name: "activeUsers" }
                        ],
                        dateRanges: [
                            { startDate: "30daysAgo", endDate: "today" }
                        ]
                    }
                }).then(response => {
                    const rows = response.result.rows || [];
                    displayData(rows);
                }).catch(error => {
                    console.error("Error fetching data", error);
                });
            });
        }

        function displayData(rows) {
            const output = document.getElementById("output");
            if (rows.length === 0) {
                output.innerHTML = "<p>No data available</p>";
                return;
            }

            const table = document.createElement("table");
            table.border = "1";
            table.innerHTML = `
                <tr>
                    <th>Country</th>
                    <th>Gender</th>
                    <th>Age</th>
                    <th>Active Users</th>
                </tr>
            `;
            rows.forEach(row => {
                const rowHTML = `
                    <tr>
                        <td>${row.dimensionValues[0].value}</td>
                        <td>${row.dimensionValues[1].value}</td>
                        <td>${row.dimensionValues[2].value}</td>
                        <td>${row.metricValues[0].value}</td>
                    </tr>
                `;
                table.innerHTML += rowHTML;
            });
            output.innerHTML = "";
            output.appendChild(table);
        }
    </script>
</body>
</html>
